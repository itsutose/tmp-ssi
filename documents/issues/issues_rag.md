# FastAPI実装関連 Issue一覧

## Issue テンプレート

```markdown
## Issue タイトル
**優先度**: High/Medium/Low
**カテゴリ**: API/RAG/エラーハンドリング/セキュリティ
**依存関係**: [関連Issue番号]

### 課題概要
[課題の概要を簡潔に記述]

### 実装詳細
- [ ] 詳細タスク1
- [ ] 詳細タスク2
- [ ] 詳細タスク3

### 技術要件
- 使用技術: [技術スタック]
- 制約事項: [制約・注意点]

### テスト項目
- [ ] 単体テスト
- [ ] 統合テスト
- [ ] E2Eテスト

### 完了条件
- [ ] 機能実装完了
- [ ] テスト完了
- [ ] ドキュメント更新
```

---

## RAG-001: REST APIエンドポイント基盤実装
**優先度**: High
**カテゴリ**: API
**依存関係**: INFRA-001, INFRA-002

### 課題概要
FastAPIを使用したRESTfulAPIエンドポイントの基盤を実装する。Mangumを使用してLambda環境でFastAPIを動作させる。認証はAPI Gateway Cognito Authorizerで行うため、FastAPI側での認証実装は不要。

### 実装詳細
- [ ] FastAPIアプリケーション基盤構築
- [ ] Mangumアダプターの設定
- [ ] 共通レスポンス形式の実装
- [ ] ヘルスチェックエンドポイント実装 (`GET /health`, `GET /rag/health`)
- [ ] CORS設定とHTTPヘッダー設定
- [ ] OpenAPI仕様書自動生成設定

### 技術要件
- 使用技術: FastAPI, Mangum, Pydantic
- 制約事項: Lambda環境での動作、API Gateway連携、認証はAPI Gateway側で実装

### テスト項目
- [ ] ヘルスチェックAPIテスト
- [ ] レスポンス形式テスト
- [ ] CORS動作テスト

### 完了条件
- [ ] 基本APIエンドポイント動作確認
- [ ] Lambda環境でのFastAPI動作確認
- [ ] OpenAPI仕様書生成確認

---

## RAG-002: 文書検索API実装
**優先度**: High
**カテゴリ**: RAG
**依存関係**: RAG-001, INFRA-004, INFRA-005

### 課題概要
`POST /search`エンドポイントを実装し、ベクトル検索、キーワード検索、ハイブリッド検索機能を提供する。

### 実装詳細
- [ ] 検索リクエストモデル定義 (Pydantic)
- [ ] Bedrock Embedding API連携実装
- [ ] Pineconeベクトル検索実装
- [ ] キーワード検索 (BM25) 実装
- [ ] ハイブリッド検索ロジック実装
- [ ] リランキング機能実装
- [ ] フォルダ指定検索機能実装
- [ ] 検索結果レスポンスモデル実装

### 技術要件
- 使用技術: LangChain, boto3, Pinecone SDK
- 制約事項: レスポンスタイム15秒以内、最大10件返却

### テスト項目
- [ ] ベクトル検索機能テスト
- [ ] キーワード検索機能テスト
- [ ] ハイブリッド検索機能テスト
- [ ] フォルダ指定検索テスト

### 完了条件
- [ ] 各検索戦略の動作確認
- [ ] パフォーマンス要件満足確認
- [ ] エラーハンドリング動作確認

---

## RAG-003: チェック機能API実装
**優先度**: High
**カテゴリ**: RAG
**依存関係**: RAG-001, RAG-002

### 課題概要
`POST /check`エンドポイントを実装し、コンプライアンスチェック、約款チェック、表記チェック機能を統合API として提供する。

### 実装詳細
- [ ] チェックリクエストモデル定義 (check_type: compliance/term/expression)
- [ ] コンプライアンスチェックロジック実装
- [ ] 約款チェックロジック実装
- [ ] 表記チェックロジック実装
- [ ] 参照文書検索・取得機能
- [ ] チェック結果生成機能
- [ ] 重要度判定ロジック実装
- [ ] チェック結果レスポンスモデル実装

### 技術要件
- 使用技術: LangChain, boto3, Bedrock Claude
- 制約事項: 同期処理、レスポンスタイム5秒以内

### テスト項目
- [ ] コンプライアンスチェック機能テスト
- [ ] 約款チェック機能テスト
- [ ] 表記チェック機能テスト
- [ ] エラーケースハンドリングテスト

### 完了条件
- [ ] 各チェック機能の動作確認
- [ ] 重要度判定の精度確認
- [ ] パフォーマンス要件満足確認

---

## RAG-004: 文書管理API実装
**優先度**: Medium
**カテゴリ**: API
**依存関係**: RAG-001, INFRA-001, INFRA-006

### 課題概要
文書アップロード、ダウンロード、一覧取得、削除のCRUD APIを実装する。

### 実装詳細
- [ ] `POST /upload` - 文書アップロード実装
- [ ] `GET /download` - 文書ダウンロード実装
- [ ] `GET /documents` - 文書一覧取得実装
- [ ] `DELETE /documents/{document_id}` - 文書削除実装
- [ ] S3アップロード・ダウンロード処理
- [ ] DynamoDB文書メタデータ管理
- [ ] ファイルサイズ制限チェック (10MB)
- [ ] ファイル形式チェック (PDF, CSV, TXT)

### 技術要件
- 使用技術: boto3, botocore
- 制約事項: ファイルサイズ10MB制限、対応形式制限

### テスト項目
- [ ] アップロード機能テスト
- [ ] ダウンロード機能テスト
- [ ] 一覧取得機能テスト
- [ ] 削除機能テスト

### 完了条件
- [ ] CRUD操作の動作確認
- [ ] エラーハンドリング動作確認
- [ ] ファイル制限の動作確認

---

## RAG-005: サンドボックス環境API実装
**優先度**: Medium
**カテゴリ**: API
**依存関係**: RAG-001, INFRA-007

### 課題概要
プロンプト管理機能を提供するサンドボックス環境APIを実装する。

### 実装詳細
- [ ] `GET /sandbox/prompts` - プロンプト一覧取得実装
- [ ] `GET /sandbox/prompts/{prompt_id}` - プロンプト取得実装
- [ ] `POST /sandbox/prompts` - プロンプト作成実装
- [ ] `PUT /sandbox/prompts/{prompt_id}` - プロンプト更新実装
- [ ] DynamoDB Promptsテーブル連携
- [ ] プロンプトバージョン管理機能
- [ ] プロンプトカテゴリ管理機能

### 技術要件
- 使用技術: boto3, Pydantic
- 制約事項: バージョン管理必須、カテゴリ分類必須

### テスト項目
- [ ] プロンプトCRUD機能テスト
- [ ] バージョン管理テスト
- [ ] カテゴリ検索テスト

### 完了条件
- [ ] プロンプト管理機能動作確認
- [ ] バージョン管理動作確認
- [ ] カテゴリ管理動作確認

---

## RAG-006: 履歴管理API実装
**優先度**: Medium
**カテゴリ**: API
**依存関係**: RAG-001, INFRA-008

### 課題概要
検索履歴とチェック履歴を管理するAPIを実装する。

### 実装詳細
- [ ] `GET /history/search` - 検索履歴取得実装
- [ ] `GET /history/checks` - チェック履歴取得実装
- [ ] DynamoDB ProcessingHistoryテーブル連携
- [ ] ページネーション機能実装
- [ ] 日付範囲検索機能実装
- [ ] ユーザー別履歴フィルタ機能

### 技術要件
- 使用技術: boto3, Pydantic
- 制約事項: TTL 2年間、ページネーション必須

### テスト項目
- [ ] 履歴取得機能テスト
- [ ] ページネーション機能テスト
- [ ] フィルタ機能テスト

### 完了条件
- [ ] 履歴管理機能動作確認
- [ ] フィルタ機能動作確認
- [ ] ページネーション動作確認

---

## RAG-007: エラーハンドリング・ログ機能実装
**優先度**: High
**カテゴリ**: エラーハンドリング
**依存関係**: RAG-001

### 課題概要
統一されたエラーハンドリングとログ機能を実装し、運用監視を効率化する。

### 実装詳細
- [ ] 共通エラーハンドラー実装
- [ ] HTTP ステータスコード別エラーレスポンス
- [ ] ビジネスロジックエラーコード実装 (RAG_001-004)
- [ ] 構造化ログ実装 (CloudWatch Logs)
- [ ] エラー追跡機能実装
- [ ] パフォーマンスメトリクス記録

### 技術要件
- 使用技術: FastAPI exception handlers, Python logging
- 制約事項: 構造化ログ必須、機密情報マスキング

### テスト項目
- [ ] エラーレスポンス形式テスト
- [ ] ログ出力テスト
- [ ] エラー分類テスト

### 完了条件
- [ ] エラーハンドリング動作確認
- [ ] ログ出力確認
- [ ] エラー分類動作確認

---

## RAG-008: データ処理パイプライン実装
**優先度**: Medium
**カテゴリ**: RAG
**依存関係**: RAG-004, INFRA-009

### 課題概要
文書アップロード時のチャンキング・ベクトル化処理パイプラインを実装する。

### 実装詳細
- [ ] S3イベントトリガー処理実装
- [ ] Docling文書処理機能実装
- [ ] チャンキング戦略実装 (semantic, character, structure)
- [ ] Bedrock Embedding生成実装
- [ ] Pineconeベクトル登録実装
- [ ] DynamoDB Documents テーブルステータス更新
- [ ] エラー処理・リトライ機能実装

### 技術要件
- 使用技術: Docling, LangChain, boto3, Pinecone SDK
- 制約事項: 非同期処理、エラー耐性

### テスト項目
- [ ] 文書処理パイプラインテスト
- [ ] チャンキング戦略テスト
- [ ] ベクトル化処理テスト
- [ ] エラー処理テスト

### 完了条件
- [ ] 処理パイプライン動作確認
- [ ] エラー処理動作確認
- [ ] パフォーマンス確認

---

## RAG-009: セキュリティ機能実装
**優先度**: Medium
**カテゴリ**: セキュリティ
**依存関係**: RAG-001

### 課題概要
セキュリティ要件に沿った暗号化、監査ログ機能を実装する。認証・認可はAPI Gateway側で実装済み。

### 実装詳細
- [ ] リクエスト・レスポンスの機密情報マスキング
- [ ] セキュリティヘッダー実装
- [ ] 監査ログ実装
- [ ] APIアクセスログ実装

### 技術要件
- 使用技術: FastAPI middleware, boto3
- 制約事項: 機密情報保護、認証はAPI Gateway側で実装

### テスト項目
- [ ] セキュリティヘッダーテスト
- [ ] 監査ログテスト
- [ ] 機密情報マスキングテスト

### 完了条件
- [ ] セキュリティ機能動作確認
- [ ] 監査ログ動作確認
- [ ] 機密情報保護確認