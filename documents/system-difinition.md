# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹è¦ä»¶å®šç¾©æ›¸

## 1. ç›®çš„

Advanced RAGã‚·ã‚¹ãƒ†ãƒ ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚µãƒ¼ãƒ“ã‚¹ã‚’æ§‹ç¯‰ã—ã€æ–‡æ›¸æ¤œç´¢ã€ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯ã€ç´„æ¬¾ãƒã‚§ãƒƒã‚¯ã€è¡¨è¨˜ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã®ç–çµåˆãªè¨­è¨ˆã«ã‚ˆã‚Šã€ç‹¬ç«‹ã—ãŸé–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å¯èƒ½ã«ã™ã‚‹ã€‚

## 2. æœ¬è¦ä»¶å®šç¾©æ›¸ã®ç¯„å›²

æœ¬è¦ä»¶å®šç¾©æ›¸ã¯ã€Advanced RAGã‚·ã‚¹ãƒ†ãƒ ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚µãƒ¼ãƒ“ã‚¹ã®æ©Ÿèƒ½è¦ä»¶ã€éæ©Ÿèƒ½è¦ä»¶ã€æŠ€è¡“ä»•æ§˜ã€ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆã‚’å®šç¾©ã™ã‚‹ã€‚

## 3. æ©Ÿèƒ½è¦ä»¶

### 3.1 Advanced RAG ã®æ‰‹ç¶šãæ§‹æˆ

#### 3.1.1 æ¤œç´¢ãƒ»ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½

- **æ–‡æ›¸æ¤œç´¢**
  - æ¦‚è¦ï¼šæŒ‡å®šã•ã‚ŒãŸã‚¯ã‚¨ãƒªã«å¯¾ã—ã¦é–¢é€£æ–‡æ›¸ã‚’æ¤œç´¢ãƒ»å–å¾—
  - æ¤œç´¢å¯¾è±¡ï¼šã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå…¨ã¦ã®æ–‡æ›¸
  - æ¤œç´¢æˆ¦ç•¥ï¼šãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢
  - ãƒ•ã‚©ãƒ«ãƒ€æŒ‡å®šæ¤œç´¢ï¼šç‰¹å®šãƒ•ã‚©ãƒ«ãƒ€å†…ã®æ–‡æ›¸ã«é™å®šã—ãŸæ¤œç´¢

- **ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒã‚§ãƒƒã‚¯**
  - æ¦‚è¦ï¼šä¸ãˆã‚‰ã‚ŒãŸæ–‡ç« ãŒé‡‘èæ³•ãªã©ã®é–¢é€£æ³•å¾‹ã«é•åã—ãŸæ›¸ãæ–¹ã‚’ã—ã¦ã„ãªã„ã‹ã‚’ãƒã‚§ãƒƒã‚¯
  - æ¤œç´¢å¯¾è±¡ï¼šæ³•å‹™æ–‡æ›¸ï¼ˆlegal/compliance, legal/regulations, legal/policiesï¼‰
  - å‡¦ç†æ–¹å¼ï¼šåŒæœŸå‡¦ç†ï¼ˆå³åº§ã«ãƒã‚§ãƒƒã‚¯çµæœã‚’è¿”ã™ï¼‰

- **ç´„æ¬¾ãƒã‚§ãƒƒã‚¯**
  - æ¦‚è¦ï¼šä¸ãˆã‚‰ã‚ŒãŸæ–‡ç« ãŒç´„æ¬¾æƒ…å ±ã«é•å/çŸ›ç›¾ã—ãŸå†…å®¹ãŒãªã„ã‹ã‚’æ¤œæŸ»
  - æ¤œç´¢å¯¾è±¡ï¼šç´„æ¬¾æƒ…å ±ã‚’å«ã‚€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆterms/life-insurance, terms/property-insurance, terms/commonï¼‰
  - å‡¦ç†æ–¹å¼ï¼šåŒæœŸå‡¦ç†ï¼ˆå³åº§ã«ãƒã‚§ãƒƒã‚¯çµæœã‚’è¿”ã™ï¼‰

- **è¡¨è¨˜ãƒã‚§ãƒƒã‚¯**
  - æ¦‚è¦ï¼šä¸ãˆã‚‰ã‚ŒãŸæ–‡æ›¸ãŒæ­£ã—ã„è¡¨è¨˜æ³•ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯
  - æ¤œç´¢å¯¾è±¡ï¼šè¡¨è¨˜æ–¹æ³•ã‚’ã¾ã¨ã‚ãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆnotation/style-guides, notation/dictionariesï¼‰
  - å‡¦ç†æ–¹å¼ï¼šåŒæœŸå‡¦ç†ï¼ˆå³åº§ã«ãƒã‚§ãƒƒã‚¯çµæœã‚’è¿”ã™ï¼‰

#### 3.1.2 ç°¡ç´ åŒ–ã•ã‚ŒãŸãƒã‚§ãƒƒã‚¯å‡¦ç†ãƒ•ãƒ­ãƒ¼

```mermaid
graph LR
    subgraph "ğŸ“ ãƒã‚§ãƒƒã‚¯å‡¦ç†"
        A["æ–‡æ›¸å…¥åŠ›"] --> B["POST /check"]
        B --> C["Step Functions"]
        C --> D["Lambdaå®Ÿè¡Œ"]
        D --> E["Bedrockè§£æ"]
        D --> F["Pineconeæ¤œç´¢"]
        D --> G["S3å‚ç…§æ–‡æ›¸"]
        E --> H["ãƒã‚§ãƒƒã‚¯çµæœç”Ÿæˆ"]
        F --> H
        G --> H
        H --> I["çµæœè¿”å´"]
    end
    
    subgraph "âœ… çµæœå†…å®¹"
        I --> J["å•é¡Œç‚¹ãƒªã‚¹ãƒˆ"]
        J --> K["é‡è¦åº¦"]
        J --> L["å ´æ‰€"]
        J --> M["å‚ç…§æ–‡æ›¸"]
    end
    
    %% Styling
    classDef process fill:#fff3e0
    classDef result fill:#e8f5e8
    
    class A,B,C,D,E,F,G,H,I process
    class J,K,L,M result
```

#### 3.1.3 RAGå‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

- **Pre-Retrievalå‡¦ç†**
  - æ¤œç´¢ã‚¯ã‚¨ãƒªã®ç”Ÿæˆãƒ»æ‹¡å¼µ
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ–‡æ›¸ã®åˆ†å‰²ãƒ»å‰å‡¦ç†

- **æ¤œç´¢æˆ¦ç•¥**
  - ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ï¼ˆã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ï¼‰
  - ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼ˆBM25ï¼‰
  - ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ¤œç´¢ï¼ˆãƒ™ã‚¯ãƒˆãƒ« + ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼‰

- **Post-Retrievalå‡¦ç†**
  - ãƒªãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆé–¢é€£åº¦ã«ã‚ˆã‚‹å†é †åºä»˜ã‘ï¼‰
  - ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿åœ§ç¸®
  - RAG Fusionå‡¦ç†

- **å›ç­”ç”Ÿæˆ**
  - æ¤œç´¢çµæœã«åŸºã¥ãå›ç­”ç”Ÿæˆ
  - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†
  - ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã®è€ƒæ…®

#### 3.1.3 ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½

- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼ˆ30æ—¥é–“ä¿æŒï¼‰
- ä¼šè©±å±¥æ­´ã®ä¿æŒ
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ç¶™ç¶š

### 3.2 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†æ©Ÿèƒ½

#### 3.2.1 ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ»åŸ‹ã‚è¾¼ã¿

- **å¯¾å¿œãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå½¢å¼**
  - PDF
  - CSV
  - ãã®ä»–ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«

- **ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°æˆ¦ç•¥**
  - æ–‡å­—æ•°ãƒ™ãƒ¼ã‚¹ã®ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°
  - ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°
  - æ–‡æ›¸æ§‹é€ ã‚’è€ƒæ…®ã—ãŸãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°

- **ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**
  - Pineconeï¼ˆå…¨ç’°å¢ƒçµ±ä¸€ï¼‰
    - é–‹ç™ºç’°å¢ƒï¼šç‹¬ç«‹ã—ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    - ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒï¼šç‹¬ç«‹ã—ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    - æœ¬ç•ªç’°å¢ƒï¼šç‹¬ç«‹ã—ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

- **æ–‡æ›¸ä¿ç®¡ãƒ»ç®¡ç†**
  - æ–‡æ›¸ã®åŸæœ¬ï¼šS3ã«ä¿ç®¡ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½
  - æ–‡æ›¸ã®ç›®éŒ²ã¨ä¿ç®¡å…ˆï¼šDynamoDBã«ç™»éŒ²
  - æ–‡æ›¸ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†

#### 3.2.1.1 é«˜åº¦ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‰Šé™¤æ©Ÿèƒ½

- **å˜ä¸€æ–‡æ›¸å‰Šé™¤**
  - DynamoDBæ–‡æ›¸ãƒ¬ã‚³ãƒ¼ãƒ‰å‰Šé™¤
  - S3ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤
  - Pineconeãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
  - ã‚«ãƒ†ã‚´ãƒªæ–‡æ›¸æ•°ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°

- **ã‚«ãƒ†ã‚´ãƒªåˆ¥ä¸€æ‹¬å‰Šé™¤**
  - æŒ‡å®šã‚«ãƒ†ã‚´ãƒªå†…ã®å…¨æ–‡æ›¸å‰Šé™¤
  - é–¢é€£S3ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¸€æ‹¬å‰Šé™¤
  - é–¢é€£ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬å‰Šé™¤
  - å‰Šé™¤å‡¦ç†ã®é€²æ—è¿½è·¡

#### 3.2.1.2 ã‚«ãƒ†ã‚´ãƒªç®¡ç†æ©Ÿèƒ½

- **ã‚«ãƒ†ã‚´ãƒªéšå±¤ç®¡ç†**
  - è¦ªå­é–¢ä¿‚ã‚’æŒã¤ã‚«ãƒ†ã‚´ãƒªæ§‹é€ 
  - ã‚«ãƒ†ã‚´ãƒªä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤
  - ã‚«ãƒ†ã‚´ãƒªåˆ¥æ–‡æ›¸æ•°ã®è‡ªå‹•é›†è¨ˆ

- **æ–‡æ›¸ã‚«ãƒ†ã‚´ãƒªå¤‰æ›´**
  - æ–‡æ›¸ã®æ‰€å±ã‚«ãƒ†ã‚´ãƒªå¤‰æ›´
  - S3ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ç§»å‹•ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  - ã‚«ãƒ†ã‚´ãƒªæ–‡æ›¸æ•°ã®è‡ªå‹•æ›´æ–°

- **ã‚«ãƒ†ã‚´ãƒªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç®¡ç†**
  - è¡¨ç¤ºåãƒ»èª¬æ˜ãƒ»ã‚¢ã‚¤ã‚³ãƒ³ãƒ»è‰²ã®ç®¡ç†
  - S3ä¿å­˜ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®ç®¡ç†
  - ã‚¢ã‚¯ãƒ†ã‚£ãƒ–/éã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ç®¡ç†

#### 3.2.2 S3ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ§‹æˆ

- **Documents ãƒã‚±ãƒƒãƒˆ**: æ–‡æ›¸åŸæœ¬ä¿ç®¡
  - legal/: æ³•å‹™æ–‡æ›¸ï¼ˆcompliance, regulations, policiesï¼‰
  - terms/: ç´„æ¬¾æƒ…å ±ï¼ˆlife-insurance, property-insurance, commonï¼‰
  - notation/: è¡¨è¨˜æ–¹æ³•ï¼ˆstyle-guides, dictionariesï¼‰
  - general/: ä¸€èˆ¬æ–‡æ›¸ï¼ˆmanuals, faqs, othersï¼‰
  - uploads/: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆä¸€æ™‚ä¿ç®¡ï¼‰

- **Temporary ãƒã‚±ãƒƒãƒˆ**: ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ä¿ç®¡
  - uploads/: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸€æ™‚ä¿ç®¡ï¼ˆ24æ™‚é–“ï¼‰
  - processing/: å‡¦ç†ä¸­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ7æ—¥é–“ï¼‰
  - chunks/: ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°çµæœï¼ˆ30æ—¥é–“ï¼‰

- **Prompts ãƒã‚±ãƒƒãƒˆ**: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€DynamoDBã®ã¿ã§ã‚‚å¯ï¼‰
  - system/: ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
  - user/: ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

#### 3.2.3 DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆ

- **Documents ãƒ†ãƒ¼ãƒ–ãƒ«**: æ–‡æ›¸ç®¡ç†
  - Primary Key: documentId
  - GSI: category-uploadedAt-index, uploadedBy-uploadedAt-index
  
- **ChatSessions ãƒ†ãƒ¼ãƒ–ãƒ«**: ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
  - Primary Key: sessionId, Sort Key: messageIndex
  - GSI: userId-timestamp-index
  - TTL: 30æ—¥é–“

- **ProcessingHistory ãƒ†ãƒ¼ãƒ–ãƒ«**: å‡¦ç†å±¥æ­´ç®¡ç†
  - Primary Key: executionId
  - GSI: userId-createdAt-index, queryType-createdAt-index
  - TTL: 2å¹´é–“ï¼ˆBedrockå±¥æ­´ï¼‰

- **Prompts ãƒ†ãƒ¼ãƒ–ãƒ«**: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†
  - Primary Key: promptKey, Sort Key: version
  - GSI: category-isActive-index

- **UserSessions ãƒ†ãƒ¼ãƒ–ãƒ«**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
  - Primary Key: userId, Sort Key: sessionId
  - GSI: sessionId-index
  - TTL: 30æ—¥é–“

- **SandboxTests ãƒ†ãƒ¼ãƒ–ãƒ«**: ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆç®¡ç†
  - Primary Key: testId
  - GSI: userId-createdAt-index, promptId-createdAt-index, checkType-createdAt-index
  - TTL: 1å¹´é–“

- **Categories ãƒ†ãƒ¼ãƒ–ãƒ«**: ã‚«ãƒ†ã‚´ãƒªç®¡ç†
  - Primary Key: categoryId
  - GSI: name-index, parentCategoryId-index, isActive-createdAt-index

- **AlertSettings ãƒ†ãƒ¼ãƒ–ãƒ«**: ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šç®¡ç†
  - Primary Key: alertId
  - GSI: alertType-severity-index, isActive-createdAt-index

### 3.3 å±¥æ­´ç®¡ç†æ©Ÿèƒ½

#### 3.3.1 å›ç­”å±¥æ­´ã®å‚ç…§

- Step Function ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹çµæœã‚’DynamoDBã«ç™»éŒ²
- æ¤œç´¢å±¥æ­´ã®ä¿å­˜ãƒ»å‚ç…§
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥å±¥æ­´ç®¡ç†
- å°†æ¥çš„ã«AppSync (GraphQL)ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã«ã™ã‚‹äºˆå®š

### 3.4 APIè¨­è¨ˆ

- RESTful APIè¨­è¨ˆ
- OpenAPIä»•æ§˜æ›¸ã®æä¾›
- ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°å¯¾å¿œï¼ˆURL ãƒ‘ã‚¹ã«ã‚ˆã‚‹ï¼‰
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ãƒ•ãƒ­ãƒ³ãƒˆã§æŒ‡å®šã—ã€æŒ‡å®šã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½¿ç”¨ã™ã‚‹
- JWT Bearer Tokenèªè¨¼ï¼ˆCognitoï¼‰

#### 3.4.1 ä¸»è¦APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ç³»**: `/health`, `/rag/health`
- **æ–‡æ›¸æ¤œç´¢ç³»**: `POST /search` â€»Step FunctionséåŒæœŸå‡¦ç†
- **ãƒã‚§ãƒƒã‚¯ç³»**: `POST /check` â€»Step FunctionséåŒæœŸå‡¦ç†
- **æ–‡æ›¸ç®¡ç†ç³»**: `POST /upload` â€»Step FunctionséåŒæœŸå‡¦ç†, `GET /download`, `GET /documents`, `DELETE /documents/{id}`, `DELETE /documents/category/{category}`
- **ã‚«ãƒ†ã‚´ãƒªç®¡ç†ç³»**: `GET /categories`, `POST /categories`, `PUT /categories/{id}`, `DELETE /categories/{id}`
- **å®Ÿè¡ŒçŠ¶æ…‹ç®¡ç†**: `GET /execution/{executionId}/status`, `GET /execution/{executionId}/result`
- **ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç®¡ç†**: `GET /sandbox/prompts`, `GET /sandbox/prompts/{id}`, `POST /sandbox/prompts`, `PUT /sandbox/prompts/{id}`, `POST /sandbox/test`, `GET /sandbox/tests`, `GET /sandbox/tests/{id}/download`
- **å±¥æ­´ç®¡ç†**: `GET /history/search`, `GET /history/checks`

#### 3.4.2 Step Functionså¯¾å¿œAPIã®å‹•ä½œ

**éåŒæœŸå‡¦ç†API** (`POST /search`, `POST /check`, `POST /upload`)
1. **å³åº§ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `{"executionId": "xxx", "status": "RUNNING"}`
2. **ãƒãƒ¼ãƒªãƒ³ã‚°**: `GET /execution/{executionId}/status`
3. **çµæœå–å¾—**: `GET /execution/{executionId}/result`ï¼ˆå®Œäº†å¾Œï¼‰

**ãƒãƒ¼ãƒªãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**:
```json
{
  "executionId": "uuid-string",
  "status": "RUNNING|SUCCEEDED|FAILED",
  "startTime": "2024-01-01T00:00:00Z",
  "endTime": "2024-01-01T00:01:30Z",
  "result": { /* å®Œäº†æ™‚ã®ã¿ */ },
  "error": { /* ã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿ */ }
}
```

### 3.5 ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒ

#### 3.5.1 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†æ©Ÿèƒ½

- **æ¦‚è¦**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹ã‚’ç·¨é›†ãƒ»ä¿å­˜ã™ã‚‹æ©Ÿèƒ½
- **ãƒ‡ãƒ¼ã‚¿ç®¡ç†**: DynamoDB Prompts ãƒ†ãƒ¼ãƒ–ãƒ«ã§ç®¡ç†
- **æ©Ÿèƒ½**: 
  - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¸€è¦§å–å¾—
  - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå†…å®¹å–å¾—
  - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä½œæˆãƒ»æ›´æ–°
- **ç”¨é€”**: ãƒã‚§ãƒƒã‚¯å‡¦ç†ã§ä½¿ç”¨ã™ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

#### 3.5.2 ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹æ©Ÿèƒ½ãƒ•ãƒ­ãƒ¼

```mermaid
graph TB
    subgraph "ğŸ–ï¸ ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒ"
        A["ãƒ¦ãƒ¼ã‚¶ãƒ¼"] --> B["ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç·¨é›†"]
        B --> C["DynamoDB<br/>Prompts ãƒ†ãƒ¼ãƒ–ãƒ«"]
        C --> D["ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¿å­˜"]
        D --> E["ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"]
        E --> F["DynamoDB<br/>SandboxTests ãƒ†ãƒ¼ãƒ–ãƒ«"]
        F --> G["ãƒ†ã‚¹ãƒˆçµæœä¿å­˜"]
        G --> H["çµæœãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"]
        H --> I{"çµæœæº€è¶³ï¼Ÿ"}
        I -->|No| B
        I -->|Yes| J["å®Œäº†"]
    end
    
    subgraph "ğŸ¯ æœ¬ç•ªåˆ©ç”¨"
        E --> K["POST /check"]
        K --> L["ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä½¿ç”¨"]
        L --> M["ãƒã‚§ãƒƒã‚¯çµæœè¿”å´"]
    end
    
    subgraph "ğŸ“¥ çµæœç®¡ç†"
        F --> N["ãƒ†ã‚¹ãƒˆå±¥æ­´ç®¡ç†"]
        N --> O["çµæœæ¯”è¼ƒæ©Ÿèƒ½"]
        O --> P["ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ"]
    end
    
    %% Styling
    classDef sandbox fill:#e3f2fd
    classDef production fill:#e8f5e8
    classDef management fill:#fff3e0
    
    class A,B,C,D,E,F,G,H,I,J sandbox
    class K,L,M production
    class N,O,P management
```

#### 3.5.3 ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½

- **æ¦‚è¦**: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®åŠ¹æœã‚’äº‹å‰ã«ãƒ†ã‚¹ãƒˆã—ã€çµæœã‚’åˆ†æã™ã‚‹æ©Ÿèƒ½
- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**: æŒ‡å®šã—ãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ãƒã‚§ãƒƒã‚¯å‡¦ç†ã‚’å®Ÿè¡Œ
- **çµæœä¿å­˜**: ãƒ†ã‚¹ãƒˆçµæœã‚’DynamoDBã«ä¿å­˜ã—ã€å¾Œã‹ã‚‰å‚ç…§ãƒ»æ¯”è¼ƒå¯èƒ½
- **ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½**: ãƒ†ã‚¹ãƒˆçµæœã‚’JSON/CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½
- **å±¥æ­´ç®¡ç†**: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå±¥æ­´ã®ç®¡ç†ã¨æ¯”è¼ƒåˆ†æ

#### 3.5.4 ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹çµæœãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

- **å¯¾è±¡ãƒ‡ãƒ¼ã‚¿**: SandboxTestsãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰æŒ‡å®šã«ã‚ˆã‚‹çµæœå–å¾—
- **å‡ºåŠ›å½¢å¼**: JSON, CSV, PDFå½¢å¼ã‚’ã‚µãƒãƒ¼ãƒˆ
- **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: æ—¥ä»˜ç¯„å›²ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç¨®åˆ¥ã€ãƒ†ã‚¹ãƒˆçµæœã«ã‚ˆã‚‹çµã‚Šè¾¼ã¿
- **ãƒãƒƒãƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆçµæœã‚’ä¸€æ‹¬ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰



### 3.6 ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¨©é™

- Cognito ã«ã‚ˆã‚‹èªè¨¼ãƒ»èªå¯
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ãƒªã‚½ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

## 4. éæ©Ÿèƒ½è¦ä»¶

### 4.1 æ€§èƒ½è¦ä»¶

- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ **
  - **å³åº§ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: APIèµ·å‹•ã‹ã‚‰executionIdè¿”å´ã¾ã§ 3ç§’ä»¥å†…
  - **éåŒæœŸå‡¦ç†æ™‚é–“**:
    - æ–‡æ›¸æ¤œç´¢ï¼š15ç§’ä»¥å†…
    - ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ï¼š10ç§’ä»¥å†…ï¼ˆStep FunctionsçµŒç”±ï¼‰
    - ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼š120ç§’ä»¥å†…
  - **ãƒãƒ¼ãƒªãƒ³ã‚°é–“éš”**: 1-5ç§’ï¼ˆæ¨å¥¨ï¼‰

- **åˆ¶é™äº‹é …**
  - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼šæœ€å¤§ 10MB
  - APIå‘¼ã³å‡ºã—åˆ¶é™ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Š 1000 ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“
  - LambdaåŒæ™‚å®Ÿè¡Œæ•°ï¼š1000 åŒæ™‚å®Ÿè¡Œ
  - Step FunctionsåŒæ™‚å®Ÿè¡Œæ•°ï¼š100 åŒæ™‚å®Ÿè¡Œ
  - ãƒãƒ¼ãƒªãƒ³ã‚°é »åº¦åˆ¶é™ï¼š1ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ç§’ï¼ˆåŒä¸€executionIdï¼‰

### 4.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶

#### 4.2.1 èªè¨¼ãƒ»èªå¯

- **Cognito ã«ã‚ˆã‚‹èªè¨¼**
  - JWT ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¼ãƒ«ç®¡ç†
  - API Gateway Cognito Authorizer

#### 4.2.2 ãƒ‡ãƒ¼ã‚¿ä¿è­·

- **è»¢é€æ™‚æš—å·åŒ–**
  - TLS 1.2ä»¥ä¸Š
  - HTTPSå¿…é ˆ

- **ä¿å­˜æ™‚æš—å·åŒ–**
  - S3: Server-Side Encryption (SSE-S3)
  - DynamoDB: ä¿å­˜æ™‚æš—å·åŒ–
  - Secrets Manager: ã‚­ãƒ¼ç®¡ç†

#### 4.2.3 ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

- **S3ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š**
  - IAMãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹
  - ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã«ã‚ˆã‚‹åˆ¶é™
  - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒã‚±ãƒƒãƒˆï¼ˆãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ç¦æ­¢ï¼‰
  - ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°æœ‰åŠ¹ï¼ˆèª¤å‰Šé™¤é˜²æ­¢ï¼‰
  - MFA Deleteï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

- **DynamoDB ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
  - IAMãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹
  - ãƒªã‚½ãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«æ¨©é™åˆ¶å¾¡

- **Lambda ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**
  - æœ€å°æ¨©é™ã®åŸå‰‡
  - VPCå†…å®Ÿè¡Œï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰

### 4.3 å¯ç”¨æ€§è¦ä»¶

- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: å®šæœŸçš„ãªç”Ÿå­˜ç¢ºèª

### 4.4 é‹ç”¨ãƒ»ç›£è¦–

#### 4.4.1 ãƒ­ã‚°ç®¡ç†

- **CloudWatch Logs**
  - æ§‹é€ åŒ–ãƒ­ã‚°
  - ã‚¨ãƒ©ãƒ¼è¿½è·¡
  - ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°

- **ãƒ­ã‚°ä¿æŒæœŸé–“**
  - API Gateway ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°: 1å¹´é–“
  - Lambdaå®Ÿè¡Œãƒ­ã‚°: 1å¹´é–“
  - Step Functionå®Ÿè¡Œãƒ­ã‚°: 1å¹´é–“

#### 4.4.2 ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ

- **ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦–**
  - API Gateway: ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã€ã‚¨ãƒ©ãƒ¼ç‡ã€ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·
  - Lambda: å®Ÿè¡Œæ™‚é–“ã€ã‚¨ãƒ©ãƒ¼æ•°ã€åŒæ™‚å®Ÿè¡Œæ•°
  - DynamoDB: èª­ã¿æ›¸ãã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã€ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°
  - S3: ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã€ã‚¨ãƒ©ãƒ¼ç‡ã€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡

- **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**
  - ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®æ­»æ´»ç›£è¦–
  - å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆPineconeã€Bedrockï¼‰ã®æ¥ç¶šç¢ºèª

- **ç•°å¸¸æ¤œçŸ¥ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ**
  - ã‚¨ãƒ©ãƒ¼ç‡é–¾å€¤è¶…é
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“åŠ£åŒ–
  - ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨é‡ç•°å¸¸

#### 4.4.3 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼ç›£è¦–ãƒ»é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

- **Amplify Loggerè¨­å®š**
  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼ã®è‡ªå‹•åé›†
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¿½è·¡
  - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
  - CloudWatchã¸ã®è‡ªå‹•é€ä¿¡

- **CloudWatchãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼**
  - ã‚¨ãƒ©ãƒ¼ãƒ¬ãƒ™ãƒ«åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆERROR, WARN, FATALï¼‰
  - ç‰¹å®šãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡ºï¼ˆAPIå‘¼ã³å‡ºã—å¤±æ•—ã€èªè¨¼ã‚¨ãƒ©ãƒ¼ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰
  - ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç”Ÿæˆ

- **EventBridgeé€£æº**
  - ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ¡ä»¶æº€è¶³æ™‚ã®è‡ªå‹•ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
  - ã‚¨ãƒ©ãƒ¼è©³ç´°æƒ…å ±ã®æ§‹é€ åŒ–
  - è¤‡æ•°ãƒãƒ£ãƒ³ãƒãƒ«ã¸ã®é…ä¿¡

- **AWS Chatbotçµ±åˆ**
  - Slackãƒãƒ£ãƒ³ãƒãƒ«ã¸ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥
  - ã‚¨ãƒ©ãƒ¼è©³ç´°ã¨ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã®é€ä¿¡
  - å¯¾å¿œçŠ¶æ³ã®è¿½è·¡

#### 4.4.4 ã‚¨ãƒ©ãƒ¼ç›£è¦–ãƒ•ãƒ­ãƒ¼

```mermaid
graph LR
    subgraph "ğŸ–¥ï¸ Frontend"
        A["React App"] --> B["Amplify Logger"]
        B --> C["Error Detection"]
        C --> D["Log Formatting"]
    end
    
    subgraph "â˜ï¸ AWS CloudWatch"
        D --> E["CloudWatch Logs"]
        E --> F["Metrics Filter"]
        F --> G["Custom Metrics"]
    end
    
    subgraph "ğŸ”” Event & Notification"
        G --> H["EventBridge"]
        H --> I["Event Rules"]
        I --> J["AWS Chatbot"]
        J --> K["Slack Channel"]
    end
    
    subgraph "ğŸ“Š Monitoring Dashboard"
        G --> L["CloudWatch Dashboard"]
        L --> M["Error Trends"]
        M --> N["Performance Metrics"]
    end
    
    %% Styling
    classDef frontend fill:#e3f2fd
    classDef aws fill:#fff3e0
    classDef notification fill:#e8f5e8
    classDef monitoring fill:#f3e5f5
    
    class A,B,C,D frontend
    class E,F,G aws
    class H,I,J,K notification
    class L,M,N monitoring
```

#### 4.4.5 ç›£è¦–å¯¾è±¡ã‚¨ãƒ©ãƒ¼

- **èªè¨¼ãƒ»èªå¯ã‚¨ãƒ©ãƒ¼**
  - JWT ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™åˆ‡ã‚Œ
  - æ¨©é™ä¸è¶³ã‚¨ãƒ©ãƒ¼
  - Cognitoèªè¨¼å¤±æ•—

- **APIé€šä¿¡ã‚¨ãƒ©ãƒ¼**
  - ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
  - 5xx ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
  - Rate Limitè¶…é

- **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼**
  - JavaScriptå®Ÿè¡Œæ™‚ã‚¨ãƒ©ãƒ¼
  - React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¨ãƒ©ãƒ¼
  - çŠ¶æ…‹ç®¡ç†ã‚¨ãƒ©ãƒ¼

- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ**
  - ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚é–“è¶…é
  - APIãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶
  - ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç•°å¸¸

#### 4.4.6 ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

- **é‡è¦åº¦ãƒ¬ãƒ™ãƒ«**
  - CRITICAL: å³åº§ã«å¯¾å¿œãŒå¿…è¦ï¼ˆã‚·ã‚¹ãƒ†ãƒ åœæ­¢ãƒ¬ãƒ™ãƒ«ï¼‰
  - HIGH: 1æ™‚é–“ä»¥å†…ã«å¯¾å¿œãŒå¿…è¦
  - MEDIUM: 1æ—¥ä»¥å†…ã«å¯¾å¿œãŒå¿…è¦
  - LOW: ç›£è¦–ã®ã¿

- **é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«**
  - Slack #alerts-criticalï¼ˆCRITICAL ãƒ¬ãƒ™ãƒ«ï¼‰
  - Slack #alerts-generalï¼ˆHIGH/MEDIUM ãƒ¬ãƒ™ãƒ«ï¼‰
  - Emailé€šçŸ¥ï¼ˆCRITICAL ã®ã¿ï¼‰

### 4.5 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

- **ç–çµåˆè¨­è¨ˆ**
  - API Gateway ã«ã‚ˆã‚‹ç‹¬ç«‹ã—ãŸå®Ÿè£…
  - ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
  - ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**
  - ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
  - è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¯¾å¿œ

## 5. ãƒ‡ãƒ¼ã‚¿ä¿æŒãƒ»å‰Šé™¤ãƒãƒªã‚·ãƒ¼

### 5.1 ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“

- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŸæœ¬**: ç„¡æœŸé™ä¿æŒï¼ˆå‰Šé™¤ã¯æ˜ç¤ºçš„ãªæŒ‡ç¤ºã®ã¿ï¼‰
- **ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‰Šé™¤ã¾ã§ä¿æŒ
- **ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³**: 30æ—¥é–“ä¿æŒï¼ˆTTLè‡ªå‹•å‰Šé™¤ï¼‰
- **å‡¦ç†å±¥æ­´ï¼ˆBedrockã®å±¥æ­´ï¼‰**: 2å¹´é–“ä¿æŒï¼ˆTTLè‡ªå‹•å‰Šé™¤ï¼‰
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³**: 30æ—¥é–“ä¿æŒï¼ˆTTLè‡ªå‹•å‰Šé™¤ï¼‰
- **ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿**: 1å¹´é–“ä¿æŒ
- **ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«**: 24æ™‚é–“å¾Œè‡ªå‹•å‰Šé™¤ï¼ˆS3ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ï¼‰
- **å‡¦ç†ä¸­ãƒ•ã‚¡ã‚¤ãƒ«**: 7æ—¥é–“å¾Œè‡ªå‹•å‰Šé™¤ï¼ˆS3ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ï¼‰
- **ãƒãƒ£ãƒ³ã‚­ãƒ³ã‚°çµæœ**: 30æ—¥é–“å¾Œè‡ªå‹•å‰Šé™¤ï¼ˆS3ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ï¼‰

### 5.2 ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ãƒãƒªã‚·ãƒ¼

- **æ‰‹å‹•å‰Šé™¤**: 
  - APIã‚’é€šã˜ãŸå˜ä¸€æ–‡æ›¸å‰Šé™¤ï¼ˆDynamoDB + S3 + Pineconeï¼‰
  - APIã‚’é€šã˜ãŸã‚«ãƒ†ã‚´ãƒªåˆ¥ä¸€æ‹¬å‰Šé™¤
  - AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é€šã˜ãŸç›´æ¥å‰Šé™¤ï¼ˆç·Šæ€¥æ™‚ã®ã¿ï¼‰

- **è‡ªå‹•å‰Šé™¤**: 
  - DynamoDB TTLè¨­å®šã«ã‚ˆã‚‹è‡ªå‹•å‰Šé™¤
  - S3ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒãƒªã‚·ãƒ¼ã«ã‚ˆã‚‹è‡ªå‹•å‰Šé™¤

- **ä¸€æ‹¬å‰Šé™¤å‡¦ç†**:
  - ã‚«ãƒ†ã‚´ãƒªå‰Šé™¤æ™‚ã®é–¢é€£æ–‡æ›¸ä¸€æ‹¬å‰Šé™¤
  - è¦ªã‚«ãƒ†ã‚´ãƒªå‰Šé™¤æ™‚ã®å­ã‚«ãƒ†ã‚´ãƒªå‡¦ç†ï¼ˆå‰Šé™¤/ç§»å‹•/å­¤ç«‹åŒ–ï¼‰
  - å‰Šé™¤å‡¦ç†ã®é€²æ—è¿½è·¡ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- **å‰Šé™¤æ™‚ã®æ•´åˆæ€§ä¿è¨¼**:
  - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³çš„ãªå‰Šé™¤å‡¦ç†
  - å‰Šé™¤å¤±æ•—æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
  - ã‚«ãƒ†ã‚´ãƒªæ–‡æ›¸æ•°ã‚«ã‚¦ãƒ³ãƒˆã®è‡ªå‹•æ›´æ–°

- **Bedrockã®å±¥æ­´**: ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’è¨­å®šã—ã€è‡ªå‹•ã§å‰Šé™¤ã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®š

### 5.3 S3ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«è¨­å®š

| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒ©ã‚¹ | æœŸé–“ | å¯¾è±¡ |
|-----------------|------|------|
| Standard | 30æ—¥ | æ–°è¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ |
| Standard-IA | 90æ—¥ | ã‚¢ã‚¯ã‚»ã‚¹é »åº¦ä½ä¸‹ |
| Glacier Flexible Retrieval | 365æ—¥ | é•·æœŸä¿ç®¡ |
| Glacier Deep Archive | ç„¡æœŸé™ | ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼ˆå‰Šé™¤ã¯æ˜ç¤ºçš„æŒ‡ç¤ºã®ã¿ï¼‰ |

## 6. ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ

### 6.1 AWS ã‚µãƒ¼ãƒ“ã‚¹æ§‹æˆ

- **API Gateway**: RESTful APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **Lambda**: ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹å®Ÿè¡Œç’°å¢ƒ
- **Step Functions**: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç®¡ç†ï¼ˆéåŒæœŸå‡¦ç†ãƒ»ãƒãƒ¼ãƒªãƒ³ã‚°æ©Ÿèƒ½ï¼‰
- **ECR**: Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ç®¡ç†
- **DynamoDB**: NoSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **S3**: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆ4ãƒã‚±ãƒƒãƒˆæ§‹æˆï¼‰
- **Bedrock**: LLMã‚µãƒ¼ãƒ“ã‚¹
  - **ãƒŠãƒ¬ãƒƒã‚¸ãƒ™ãƒ¼ã‚¹**: Pineconeã¸ã®ã‚¢ã‚¯ã‚»ã‚¹
  - **Embeddingç”Ÿæˆ**: ãƒ†ã‚­ã‚¹ãƒˆãƒ™ã‚¯ãƒˆãƒ«åŒ–
- **Pinecone**: Vector Databaseï¼ˆå…¨ç’°å¢ƒçµ±ä¸€ï¼‰
- **Cognito**: èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹
- **Secrets Manager**: ã‚­ãƒ¼ç®¡ç†
- **CloudWatch**: ãƒ­ã‚°ç®¡ç†ãƒ»ç›£è¦–ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹
- **EventBridge**: ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»é€šçŸ¥ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- **AWS Chatbot**: Slacké€šçŸ¥ãƒ»ãƒãƒ£ãƒƒãƒˆOps
- **SNS**: é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆEmailã€SMSï¼‰
- **Amplify**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ»ãƒ­ã‚°åé›†

### 6.1.1 Step Functionsã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

FastAPIã®æ™‚é–“ãŒã‹ã‹ã‚‹å‡¦ç†ï¼ˆRAGã«ã‚ˆã‚‹ã‚µãƒ¼ãƒã€ãƒã‚§ãƒƒã‚¯ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰ã¯ã€**Step Functionsã‚’ç”¨ã„ãŸãƒãƒ¼ãƒªãƒ³ã‚°æ–¹å¼**ã§å®Ÿè£…ã•ã‚Œã¾ã™ã€‚

#### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ•ãƒ­ãƒ¼
1. **API Gateway** â†’ **Lambdaï¼ˆStep Functionsèµ·å‹•ï¼‰** â†’ **Step Functions** â†’ **ãƒ—ãƒ­ã‚­ã‚·Lambda** â†’ **FastAPI**

#### æ§‹æˆè¦ç´ 
- **API Gateway**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ã®APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡
- **Step Functionsèµ·å‹•Lambda**: Step Functionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é–‹å§‹ã—ã€å®Ÿè¡ŒIDã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹
- **Step Functions**: éåŒæœŸå‡¦ç†ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç®¡ç†ãƒ»å®Ÿè¡Œ
- **ãƒ—ãƒ­ã‚­ã‚·Lambda**: Step Functionsã¨FastAPIã®é–“ã§ãƒ‡ãƒ¼ã‚¿æ•´å½¢ãƒ»ãƒ—ãƒ­ã‚­ã‚·å‡¦ç†
- **FastAPI Lambda**: å®Ÿéš›ã®RAGå‡¦ç†ã€ãƒã‚§ãƒƒã‚¯å‡¦ç†ã€ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã‚’å®Ÿè¡Œ

#### ãƒãƒ¼ãƒªãƒ³ã‚°å‡¦ç†ãƒ•ãƒ­ãƒ¼
```mermaid
sequenceDiagram
    participant Frontend as ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
    participant APIGW as API Gateway
    participant InvokeLambda as Step Functionsèµ·å‹•Lambda
    participant SF as Step Functions
    participant ProxyLambda as ãƒ—ãƒ­ã‚­ã‚·Lambda
    participant FastAPI as FastAPI Lambda
    participant Storage as S3/DynamoDB
    
    Note over Frontend, Storage: Step Functionsã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†ãƒ•ãƒ­ãƒ¼
    
    %% åˆæœŸãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    Frontend->>APIGW: POST /search (æ™‚é–“ãŒã‹ã‹ã‚‹å‡¦ç†)
    APIGW->>InvokeLambda: ãƒªã‚¯ã‚¨ã‚¹ãƒˆè»¢é€
    InvokeLambda->>SF: Step Functionsé–‹å§‹
    InvokeLambda-->>APIGW: å®Ÿè¡ŒIDå³åº§ã«è¿”å´
    APIGW-->>Frontend: {"executionId": "xxx", "status": "RUNNING"}
    
    %% Step Functionså†…éƒ¨å‡¦ç†
    SF->>ProxyLambda: å…¥åŠ›ãƒ‡ãƒ¼ã‚¿æ•´å½¢
    ProxyLambda->>FastAPI: RAGå‡¦ç†å®Ÿè¡Œ
    FastAPI->>Storage: ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ»ä¿å­˜
    Storage-->>FastAPI: å‡¦ç†çµæœ
    FastAPI-->>ProxyLambda: å‡¦ç†å®Œäº†
    ProxyLambda-->>SF: æ•´å½¢æ¸ˆã¿çµæœ
    SF->>Storage: å®Ÿè¡Œçµæœä¿å­˜
    
    %% ãƒãƒ¼ãƒªãƒ³ã‚°
    loop ãƒãƒ¼ãƒªãƒ³ã‚°å‡¦ç†
        Frontend->>APIGW: GET /execution/{executionId}/status
        APIGW->>SF: å®Ÿè¡ŒçŠ¶æ…‹ç¢ºèª
        SF-->>APIGW: çŠ¶æ…‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹
        APIGW-->>Frontend: {"status": "RUNNING"} or {"status": "SUCCEEDED", "result": {...}}
    end
```

#### åˆ©ç‚¹
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–æ€§**: é•·æ™‚é–“å‡¦ç†ã§ã‚‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œãªã„
- **é€æ˜æ€§**: å®Ÿè¡ŒçŠ¶æ…‹ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¿½è·¡å¯èƒ½
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: Step Functionsã«ã‚ˆã‚‹å …ç‰¢ãªä¾‹å¤–å‡¦ç†ãƒ»ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: è¤‡æ•°ã®é•·æ™‚é–“å‡¦ç†ã‚’ä¸¦è¡Œå®Ÿè¡Œå¯èƒ½

### 6.2 AWS ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹æˆå›³

Step Functionsã«ã‚ˆã‚‹éåŒæœŸå‡¦ç†ãƒ•ãƒ­ãƒ¼: **API Gateway â†’ Lambdaï¼ˆSFèµ·å‹•ï¼‰â†’ Step Functions â†’ ãƒ—ãƒ­ã‚­ã‚·Lambda â†’ FastAPI**

```mermaid
graph TB
    subgraph "Frontend"
        FE[React/Amplify Frontend]
    end
    
    subgraph "Authentication"
        COGNITO[Amazon Cognito<br/>User Pool]
    end
    
    subgraph "API Layer"
        APIGW[API Gateway<br/>REST API]
        AUTH[Cognito Authorizer]
    end
    
    subgraph "Compute Layer"
        INVOKE_LAMBDA[Step Functionsèµ·å‹•Lambda<br/>å®Ÿè¡ŒIDå³åº§è¿”å´]
        ECR[Amazon ECR<br/>Docker Images]
    end
    
    subgraph "Orchestration Layer"
        SF[Step Functions<br/>éåŒæœŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç®¡ç†]
        PROXY_LAMBDA[ãƒ—ãƒ­ã‚­ã‚·Lambda<br/>ãƒ‡ãƒ¼ã‚¿æ•´å½¢ãƒ»è»¢é€]
        FASTAPI_LAMBDA[FastAPI Lambda<br/>RAG/ãƒã‚§ãƒƒã‚¯/ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†]
    end
    
    subgraph "Storage"
        S3_DOC[S3 Documents Bucket<br/>æ–‡æ›¸åŸæœ¬ä¿ç®¡]
        S3_TEMP[S3 Temporary Bucket<br/>ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ä¿ç®¡]
        S3_PROMPT[S3 Prompts Bucket<br/>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰]
    end
    
    subgraph "Database"
        DDB_DOCS[DynamoDB Documents<br/>æ–‡æ›¸ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿]
        DDB_CHAT[DynamoDB ChatSessions<br/>ãƒãƒ£ãƒƒãƒˆå±¥æ­´]
        DDB_HISTORY[DynamoDB ProcessingHistory<br/>å‡¦ç†å±¥æ­´]
        DDB_PROMPTS[DynamoDB Prompts<br/>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†]
        DDB_SESSIONS[DynamoDB UserSessions<br/>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³]
        DDB_EXECUTION[DynamoDB ExecutionStatus<br/>å®Ÿè¡ŒçŠ¶æ…‹ç®¡ç†]
    end
    
    subgraph "AI/ML Services"
        BEDROCK[Amazon Bedrock<br/>LLM & Embedding]
        PINECONE[Pinecone<br/>Vector Database]
    end
    
    subgraph "Security"
        SECRETS[AWS Secrets Manager<br/>API Keysç®¡ç†]
    end
    
    subgraph "Monitoring & Alerting"
        CW[CloudWatch<br/>Logs & Metrics]
        CWF[CloudWatch<br/>Metrics Filters]
        EB[EventBridge<br/>Event Routing]
        CHATBOT[AWS Chatbot<br/>Slack Notifications]
        SNS[SNS<br/>Email/SMS Alerts]
        DASHBOARD[CloudWatch<br/>Dashboard]
    end
    
    %% Authentication Flow
    FE -->|JWT Token| COGNITO
    COGNITO -->|Authorize| AUTH
    
    %% API Flow - éåŒæœŸå‡¦ç†é–‹å§‹
    FE -->|POST /search<br/>/check<br/>/upload| APIGW
    APIGW -->|Authorize| AUTH
    AUTH -->|Execute| INVOKE_LAMBDA
    INVOKE_LAMBDA -->|Start Execution| SF
    INVOKE_LAMBDA -->|å³åº§ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹<br/>executionId| APIGW
    
    %% API Flow - ãƒãƒ¼ãƒªãƒ³ã‚°
    FE -.->|GET /execution/id/status<br/>ãƒãƒ¼ãƒªãƒ³ã‚°| APIGW
    APIGW -.->|Status Check| SF
    SF -.->|Status Response| APIGW
    
    %% Step Functions Workflow
    SF -->|Invoke with Data| PROXY_LAMBDA
    PROXY_LAMBDA -->|Format & Forward| FASTAPI_LAMBDA
    FASTAPI_LAMBDA -->|Result| PROXY_LAMBDA
    PROXY_LAMBDA -->|Formatted Result| SF
    SF -->|Store Execution Result| DDB_EXECUTION
    
    %% Container Images
    ECR -->|Images| INVOKE_LAMBDA
    ECR -->|Images| PROXY_LAMBDA
    ECR -->|Images| FASTAPI_LAMBDA
    
    %% Data Storage Access
    FASTAPI_LAMBDA -->|Store/Retrieve| S3_DOC
    FASTAPI_LAMBDA -->|Temp Files| S3_TEMP
    FASTAPI_LAMBDA -->|Prompts| S3_PROMPT
    
    %% Database Operations
    FASTAPI_LAMBDA -->|Metadata| DDB_DOCS
    FASTAPI_LAMBDA -->|Chat Data| DDB_CHAT
    FASTAPI_LAMBDA -->|History| DDB_HISTORY
    FASTAPI_LAMBDA -->|Prompts Meta| DDB_PROMPTS
    FASTAPI_LAMBDA -->|Sessions| DDB_SESSIONS
    
    %% AI/ML Integration
    FASTAPI_LAMBDA -->|LLM Requests| BEDROCK
    FASTAPI_LAMBDA -->|Vector Operations| PINECONE
    
    %% Security
    FASTAPI_LAMBDA -->|API Keys| SECRETS
    
    %% Monitoring & Alerting
    INVOKE_LAMBDA -->|Logs| CW
    PROXY_LAMBDA -->|Logs| CW
    FASTAPI_LAMBDA -->|Logs| CW
    APIGW -->|Access Logs| CW
    SF -->|Execution Logs| CW
    FE -->|Frontend Logs| CW
    CW -->|Error Detection| CWF
    CWF -->|Events| EB
    EB -->|Critical Alerts| CHATBOT
    EB -->|Email Alerts| SNS
    CW -->|Metrics| DASHBOARD
    
    %% S3 Event Triggers
    S3_DOC -->|Object Created| FASTAPI_LAMBDA
    
    %% Data Flow Styling
    classDef frontend fill:#e1f5fe
    classDef api fill:#f3e5f5
    classDef compute fill:#e8f5e8
    classDef orchestration fill:#fff3e0
    classDef storage fill:#fff8e1
    classDef database fill:#fce4ec
    classDef ai fill:#e0f2f1
    classDef security fill:#fff9c4
    classDef monitoring fill:#f1f8e9
    
    class FE frontend
    class COGNITO,AUTH,APIGW api
    class INVOKE_LAMBDA,ECR compute
    class SF,PROXY_LAMBDA,FASTAPI_LAMBDA orchestration
    class S3_DOC,S3_TEMP,S3_PROMPT storage
    class DDB_DOCS,DDB_CHAT,DDB_HISTORY,DDB_PROMPTS,DDB_SESSIONS,DDB_EXECUTION database
    class BEDROCK,PINECONE ai
    class SECRETS security
    class CW,CWF,EB,CHATBOT,SNS,DASHBOARD monitoring
```

### 6.3 RAGå‡¦ç†ãƒ•ãƒ­ãƒ¼å›³

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant Frontend as ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
    participant APIGW as API Gateway
    participant Auth as Cognito Authorizer
    participant InvokeLambda as Step Functionsèµ·å‹•Lambda
    participant SF as Step Functions
    participant ProxyLambda as ãƒ—ãƒ­ã‚­ã‚·Lambda
    participant FastAPI as FastAPI Lambda
    participant S3 as S3 Storage
    participant DDB as DynamoDB
    participant Bedrock as Amazon Bedrock
    participant Pinecone as Pinecone VectorDB
    
    Note over User, Pinecone: Step Functionså¯¾å¿œ Advanced RAGå‡¦ç†ãƒ•ãƒ­ãƒ¼
    
    %% Authentication
    User->>Frontend: æ–‡æ›¸æ¤œç´¢è¦æ±‚
    Frontend->>APIGW: POST /search (JWT Token)
    APIGW->>Auth: ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼
    Auth-->>APIGW: èªè¨¼OK
    
    %% Step Functions Processing - éåŒæœŸé–‹å§‹
    APIGW->>InvokeLambda: ãƒªã‚¯ã‚¨ã‚¹ãƒˆè»¢é€
    InvokeLambda->>SF: Step Functionå®Ÿè¡Œé–‹å§‹
    InvokeLambda->>DDB: å®Ÿè¡Œé–‹å§‹çŠ¶æ…‹è¨˜éŒ²
    InvokeLambda-->>APIGW: {"executionId": "xxx", "status": "RUNNING"}
    APIGW-->>Frontend: å®Ÿè¡ŒIDå³åº§è¿”å´
    
    %% Frontend Polling (èƒŒæ™¯å‡¦ç†)
    loop ãƒãƒ¼ãƒªãƒ³ã‚°å‡¦ç†
        Note over Frontend, APIGW: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒçŠ¶æ…‹ç¢ºèª
        Frontend->>APIGW: GET /execution/{executionId}/status
        APIGW->>SF: å®Ÿè¡ŒçŠ¶æ…‹ç¢ºèª
        SF-->>APIGW: çŠ¶æ…‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹
        APIGW-->>Frontend: {"status": "RUNNING/SUCCEEDED/FAILED"}
    end
    
    %% Step Functions Workflow (ä¸¦è¡Œå‡¦ç†)
    par Step Functionså†…éƒ¨å‡¦ç†
        SF->>ProxyLambda: å…¥åŠ›ãƒ‡ãƒ¼ã‚¿æ•´å½¢
        ProxyLambda->>FastAPI: RAGå‡¦ç†è¦æ±‚
        
        %% RAG Workflow
        FastAPI->>Bedrock: Embeddingç”Ÿæˆ
        Bedrock-->>FastAPI: ã‚¯ã‚¨ãƒªãƒ™ã‚¯ãƒˆãƒ«
        FastAPI->>Pinecone: ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢å®Ÿè¡Œ
        Pinecone-->>FastAPI: é–¢é€£æ–‡æ›¸ãƒªã‚¹ãƒˆ
        FastAPI->>DDB: æ–‡æ›¸ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—
        FastAPI->>S3: æ–‡æ›¸å†…å®¹å–å¾—
        FastAPI->>Bedrock: æ¤œç´¢å›ç­”ç”Ÿæˆ
        Bedrock-->>FastAPI: æ¤œç´¢çµæœ
        
        %% Result Processing
        FastAPI->>DDB: å‡¦ç†çµæœä¿å­˜
        FastAPI-->>ProxyLambda: RAGå‡¦ç†çµæœ
        ProxyLambda->>ProxyLambda: ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ•´å½¢
        ProxyLambda-->>SF: æ•´å½¢æ¸ˆã¿çµæœ
        SF->>DDB: å®Ÿè¡Œå®Œäº†çŠ¶æ…‹ãƒ»çµæœä¿å­˜
    end
    
    %% Final Polling Response
    Frontend->>APIGW: GET /execution/{executionId}/status
    APIGW->>SF: æœ€çµ‚çŠ¶æ…‹ç¢ºèª
    SF-->>APIGW: {"status": "SUCCEEDED", "result": {...}}
    APIGW-->>Frontend: å®Œäº†çµæœ
    Frontend-->>User: æ¤œç´¢çµæœè¡¨ç¤º
    
    %% Monitoring
    SF->>DDB: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å±¥æ­´ä¿å­˜
    FastAPI->>DDB: RAGå‡¦ç†ãƒ»çµæœãƒ­ã‚°è¨˜éŒ²
```

### 6.4 RAGãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å›³

```mermaid
graph LR
    subgraph "Input Layer"
        SEARCH_QUERY[æ¤œç´¢ã‚¯ã‚¨ãƒª]
    end
    
    subgraph "RAG Processing Layer"
        PREPROCESS[å‰å‡¦ç†ãƒ»ã‚¯ã‚¨ãƒªæ‹¡å¼µ]
        EMBED[Embeddingç”Ÿæˆ]
        VECTOR_SEARCH[ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢]
        RETRIEVE[é–¢é€£æ–‡æ›¸å–å¾—]
        GENERATE[å›ç­”ç”Ÿæˆ]
    end
    
    subgraph "Storage Layer"
        S3_DOCS[S3: æ–‡æ›¸åŸæœ¬]
        VECTOR_DB[Pinecone: ãƒ™ã‚¯ãƒˆãƒ«DB]
        DDB_META[DynamoDB: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿]
    end
    
    subgraph "AI Services"
        BEDROCK_EMBED[Bedrock: Embedding]
        BEDROCK_LLM[Bedrock: LLMç”Ÿæˆ]
    end
    
    subgraph "Output Layer"
        SEARCH_RESULT[æ¤œç´¢çµæœ]
    end
    
    %% Processing Flow
    SEARCH_QUERY -->|æ–‡æ›¸æ¤œç´¢| PREPROCESS
    PREPROCESS --> EMBED
    EMBED --> VECTOR_SEARCH
    VECTOR_SEARCH --> RETRIEVE
    RETRIEVE --> GENERATE
    GENERATE --> SEARCH_RESULT
    
    %% Storage Integration
    EMBED -.->|API Call| BEDROCK_EMBED
    VECTOR_SEARCH -.->|ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢| VECTOR_DB
    RETRIEVE -->|ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—| DDB_META
    RETRIEVE -->|æ–‡æ›¸å†…å®¹å–å¾—| S3_DOCS
    GENERATE -.->|çµæœç”Ÿæˆ| BEDROCK_LLM
    
    %% Styling
    classDef input fill:#e3f2fd
    classDef process fill:#f1f8e9
    classDef storage fill:#fff3e0
    classDef ai fill:#e8f5e8
    classDef output fill:#e0f2f1
    
    class SEARCH_QUERY input
    class PREPROCESS,EMBED,VECTOR_SEARCH,RETRIEVE,GENERATE process
    class S3_DOCS,VECTOR_DB,DDB_META storage
    class BEDROCK_EMBED,BEDROCK_LLM ai
    class SEARCH_RESULT output
```

### 6.5 é–‹ç™ºãƒ»é‹ç”¨ç’°å¢ƒ

- **ç’°å¢ƒåˆ†é›¢**: dev, staging, prod
- **CI/CD**: AWS CDK
- **ã‚³ãƒ³ãƒ†ãƒŠåŒ–**: Docker
- **Infrastructure as Code**: AWS CDK 2.200.1+

## 7. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 7.1 Advanced RAG

- **LangChain**: RAGãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **FastAPI**: Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- **boto3**: AWS SDK
- **Docling**: æ–‡æ›¸å‡¦ç†
- **Mangum**: ASGI-Lambda ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼

### 7.2 é–‹ç™ºç’°å¢ƒ

- **Node.js**: 20+
- **TypeScript**: 5.3.3
- **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼**: Yarn

### 7.3 é–‹ç™ºãƒ„ãƒ¼ãƒ«

- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†**: Projen 0.77.5
- **ãƒãƒ³ãƒ‰ãƒ©ãƒ¼**: ESBuild 0.19.8
- **ã‚³ãƒ³ãƒ†ãƒŠ**: Docker, Docker Compose 3.8

### 7.4 AWS Services

- **ã‚³ã‚¢**: API Gateway, Lambda, ECR, DynamoDB, S3, Bedrock, Cognito, Secrets Manager, Step Functions
- **ç›£è¦–ãƒ»é€šçŸ¥**: CloudWatch, EventBridge, AWS Chatbot, SNS
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: Amplifyï¼ˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ»ãƒ­ã‚°åé›†ï¼‰
- **å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹**: Pineconeï¼ˆVector Databaseï¼‰

### 7.5 CI/CD

- **AWS CDK**: Infrastructure as Code

## 8. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ä¾‹å¤–å‡¦ç†

### 8.1 ã‚¨ãƒ©ãƒ¼åˆ†é¡

#### 8.1.1 ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ï¼ˆ5xxç³»ï¼‰

- **500 Internal Server Error**
  - æœªå‡¦ç†ã®ä¾‹å¤–
  - ã‚·ã‚¹ãƒ†ãƒ å†…éƒ¨ã‚¨ãƒ©ãƒ¼
  - è¨­å®šã‚¨ãƒ©ãƒ¼

- **502 Bad Gateway**
  - å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆBedrockã€Pineconeç­‰ï¼‰ã®å¿œç­”ã‚¨ãƒ©ãƒ¼
  - Lambdaé–¢æ•°ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

- **503 Service Unavailable**
  - ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ä¸­
  - ãƒªã‚½ãƒ¼ã‚¹ä¸è¶³ã«ã‚ˆã‚‹ä¸€æ™‚çš„ãªåˆ©ç”¨ä¸å¯

- **504 Gateway Timeout**
  - Step Functionå®Ÿè¡Œã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
  - å¤–éƒ¨APIå‘¼ã³å‡ºã—ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
  - ãƒ—ãƒ­ã‚­ã‚·Lambdaå¿œç­”ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

#### 8.1.2 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼ï¼ˆ4xxç³»ï¼‰

- **400 Bad Request**
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸æ­£
  - JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¨ãƒ©ãƒ¼
  - å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¶³

- **401 Unauthorized**
  - èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ä¸æ­£ãƒ»æœŸé™åˆ‡ã‚Œ
  - èªè¨¼æƒ…å ±ä¸è¶³

- **403 Forbidden**
  - æ¨©é™ä¸è¶³
  - ãƒªã‚½ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãªã—

- **404 Not Found**
  - ãƒªã‚½ãƒ¼ã‚¹ãŒå­˜åœ¨ã—ãªã„
  - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸æ­£

- **413 Payload Too Large**
  - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™è¶…éï¼ˆ10MBï¼‰
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚µã‚¤ã‚ºåˆ¶é™è¶…é

- **429 Too Many Requests**
  - APIå‘¼ã³å‡ºã—åˆ¶é™è¶…éï¼ˆ1000ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/æ™‚é–“ï¼‰
  - ãƒ¬ãƒ¼ãƒˆåˆ¶é™é©ç”¨

#### 8.1.3 ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼

- **RAG_001**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‡¦ç†ã‚¨ãƒ©ãƒ¼
  - ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼æœªå¯¾å¿œ
  - ãƒ•ã‚¡ã‚¤ãƒ«ç ´æ
  - ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºå¤±æ•—

- **RAG_002**: æ¤œç´¢å‡¦ç†ã‚¨ãƒ©ãƒ¼
  - ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼
  - æ¤œç´¢çµæœ0ä»¶
  - æ¤œç´¢ã‚¯ã‚¨ãƒªä¸æ­£

- **RAG_003**: åŸ‹ã‚è¾¼ã¿ç”Ÿæˆã‚¨ãƒ©ãƒ¼
  - Embedding API ã‚¨ãƒ©ãƒ¼
  - ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™è¶…é

- **RAG_004**: å›ç­”ç”Ÿæˆã‚¨ãƒ©ãƒ¼
  - LLM API ã‚¨ãƒ©ãƒ¼
  - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆé•·åˆ¶é™è¶…é

- **SF_001**: Step Functionså®Ÿè¡Œã‚¨ãƒ©ãƒ¼
  - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®šç¾©ã‚¨ãƒ©ãƒ¼
  - çŠ¶æ…‹é·ç§»ã‚¨ãƒ©ãƒ¼
  - å®Ÿè¡Œã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

- **SF_002**: ãƒ—ãƒ­ã‚­ã‚·Lambdaã‚¨ãƒ©ãƒ¼
  - ãƒ‡ãƒ¼ã‚¿æ•´å½¢å¤±æ•—
  - FastAPIé€šä¿¡ã‚¨ãƒ©ãƒ¼
  - ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¤‰æ›ã‚¨ãƒ©ãƒ¼

## 9. ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

### 9.1 GraphQL API

- AppSync (GraphQL) ã«ã‚ˆã‚‹æ¤œç´¢å±¥æ­´ãƒ»å‡¦ç†å±¥æ­´ã‚¢ã‚¯ã‚»ã‚¹æ©Ÿèƒ½ã®è¿½åŠ 
- DynamoDBã®æ¤œç´¢æ©Ÿèƒ½æ‹¡å¼µ
